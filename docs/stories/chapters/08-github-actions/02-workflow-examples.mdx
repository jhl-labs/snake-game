import { Meta, Source } from '@storybook/blocks';
import { Placeholder } from '../../../components/Placeholder';
import { ChapterNav } from '../../../components/ChapterNav';
import { Mermaid } from '../../../components/Mermaid';

<Meta title="Chapters/08. GitHub Actions/8.2 실전 워크플로우" />

# 8.2 실전 워크플로우

---

## 개요

이 챕터에서는 Claude Code Action을 활용한 **실전 워크플로우 패턴**을 소개합니다.
팀의 개발 프로세스를 자동화하고 코드 품질을 향상시키는 방법을 배웁니다.

<Mermaid chart={`
flowchart TB
    subgraph Workflows["자동화 워크플로우"]
        PR["PR 리뷰"]
        Issue["이슈 관리"]
        Release["릴리즈 자동화"]
        Doc["문서 동기화"]
        Security["보안 검사"]
    end

    Claude["Claude Code Action"] --> Workflows
`} />

---

## 1. 종합 PR 리뷰 워크플로우

### 워크플로우 개요

PR이 열리면 자동으로 다음을 수행합니다:
1. 코드 품질 분석
2. 보안 취약점 검사
3. 테스트 커버리지 확인
4. 문서화 상태 점검

### 워크플로우 파일

<Source
  language="yaml"
  code={`
name: Comprehensive PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  code-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 PR을 종합적으로 리뷰해주세요.

            ## 1. 코드 품질
            - 코드 가독성 및 유지보수성
            - 네이밍 컨벤션 준수
            - 중복 코드 여부
            - 함수/클래스 크기 적절성

            ## 2. 로직 검증
            - 비즈니스 로직 정확성
            - 엣지 케이스 처리
            - 에러 핸들링
            - NULL 체크 (C 코드의 경우)

            ## 3. 성능
            - 알고리즘 효율성
            - 메모리 사용량
            - 불필요한 연산

            ## 4. 보안
            - 입력 검증
            - 민감 정보 노출
            - 잠재적 취약점

            ## 5. 테스트
            - 테스트 커버리지
            - 테스트 케이스 품질

            각 항목에 대해 점수(1-5)와 구체적인 피드백을 제공해주세요.
            개선이 필요한 부분은 코드 예시와 함께 제안해주세요.
`}
/>

### 예상 출력

Claude가 PR에 다음과 같은 리뷰 코멘트를 남깁니다:

<Source
  language="markdown"
  code={`
## PR 리뷰 결과

### 1. 코드 품질 (4/5) ✅
- 전반적으로 깔끔한 코드 구조
- \`snake_move\` 함수가 50줄을 초과하여 분리 권장

### 2. 로직 검증 (3/5) ⚠️
- 경계 조건 처리에서 off-by-one 에러 발견
\`\`\`c
// 현재 코드
if (x >= GRID_WIDTH) // 문제: 인덱스가 0부터 시작

// 권장 수정
if (x >= GRID_WIDTH - 1)
\`\`\`

### 3. 성능 (5/5) ✅
- 효율적인 알고리즘 사용
- 메모리 사용량 적절

### 4. 보안 (4/5) ✅
- NULL 포인터 체크 잘 되어 있음
- 단, line 42에서 p_snake 검증 누락

### 5. 테스트 (2/5) ❌
- 테스트 코드 부재
- 최소한 경계 조건 테스트 추가 필요
`}
/>

---

## 2. 이슈 자동 처리 워크플로우

### 이슈 트리아지 (분류)

새 이슈가 생성되면 자동으로 분류하고 라벨을 추가합니다:

<Source
  language="yaml"
  code={`
name: Issue Triage

on:
  issues:
    types: [opened]

jobs:
  triage:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Analyze Issue
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 이슈를 분석하고 적절히 처리해주세요.

            ## 분류 기준
            
            **타입 라벨 (하나 선택):**
            - \`bug\`: 기존 기능의 오작동
            - \`feature\`: 새로운 기능 요청
            - \`enhancement\`: 기존 기능 개선
            - \`documentation\`: 문서 관련
            - \`question\`: 질문/도움 요청

            **우선순위 라벨 (하나 선택):**
            - \`priority:critical\`: 서비스 중단, 데이터 손실
            - \`priority:high\`: 주요 기능 영향
            - \`priority:medium\`: 일반적인 버그/기능
            - \`priority:low\`: 사소한 개선

            **컴포넌트 라벨 (해당되는 것 모두):**
            - \`component:game\`: 게임 로직
            - \`component:render\`: 렌더링
            - \`component:input\`: 입력 처리
            - \`component:build\`: 빌드 시스템

            라벨을 추가하고, 이슈 내용이 불명확하면 
            정중하게 추가 정보를 요청하는 코멘트를 남겨주세요.
`}
/>

### 이슈 할당 시 자동 구현

Claude에게 이슈를 할당하면 자동으로 코드를 구현합니다:

<Source
  language="yaml"
  code={`
name: Auto Implementation

on:
  issues:
    types: [assigned]

jobs:
  implement:
    if: github.event.assignee.login == 'claude[bot]'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Implement Feature
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 이슈의 내용을 구현해주세요.

            ## 구현 가이드라인
            
            1. **코딩 스타일**: CLAUDE.md의 컨벤션 준수
            2. **아키텍처**: MVC 패턴 유지
            3. **테스트**: 가능하면 테스트 코드 포함
            4. **문서화**: Doxygen 스타일 주석 추가
            
            ## 작업 순서
            
            1. 관련 코드 분석
            2. 구현 계획 수립
            3. 코드 작성
            4. 빌드 테스트
            5. PR 생성
            
            구현이 완료되면 이슈에 링크된 PR을 생성해주세요.
`}
/>

---

## 3. 릴리즈 자동화 워크플로우

### 릴리즈 노트 자동 생성

<Source
  language="yaml"
  code={`
name: Release Notes

on:
  push:
    tags:
      - 'v*'

jobs:
  release-notes:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate Release Notes
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이번 릴리즈의 릴리즈 노트를 생성해주세요.

            ## 포함할 내용
            
            1. **주요 변경사항 (Highlights)**
               - 가장 중요한 변경사항 3-5개

            2. **새로운 기능 (New Features)**
               - feat: 으로 시작하는 커밋들

            3. **버그 수정 (Bug Fixes)**
               - fix: 로 시작하는 커밋들

            4. **개선사항 (Improvements)**
               - refactor:, perf: 등의 커밋들

            5. **문서 (Documentation)**
               - docs: 커밋들

            6. **Breaking Changes**
               - 호환성을 깨는 변경사항 경고

            ## 형식
            
            - 사용자 친화적인 설명
            - 관련 PR/이슈 링크 포함
            - 이모지 적절히 사용
`}
/>

### 버전 범프 자동화

<Source
  language="yaml"
  code={`
name: Version Bump

on:
  workflow_dispatch:
    inputs:
      bump_type:
        description: 'Version bump type'
        required: true
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major

jobs:
  bump-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Bump Version
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            버전을 \${{ github.event.inputs.bump_type }} 업데이트해주세요.

            ## 작업 내용
            
            1. 현재 버전 확인 (Makefile, README 등)
            2. 새 버전 번호 계산
            3. 관련 파일들의 버전 업데이트
            4. CHANGELOG.md 업데이트
            5. 변경사항으로 PR 생성
            
            Semantic Versioning (MAJOR.MINOR.PATCH) 규칙을 따라주세요.
`}
/>

---

## 4. 문서 동기화 워크플로우

### API 문서 자동 업데이트

<Source
  language="yaml"
  code={`
name: Documentation Sync

on:
  push:
    branches: [main]
    paths:
      - 'src/**/*.c'
      - 'include/**/*.h'

jobs:
  sync-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update Documentation
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            코드 변경에 따라 문서를 업데이트해주세요.

            ## 확인할 문서
            
            1. **README.md**
               - 설치 방법이 여전히 유효한지
               - 사용 예제가 현재 API와 맞는지
               - 빌드 명령어가 정확한지

            2. **include/*.h 주석**
               - 함수 시그니처와 Doxygen 주석 일치 여부
               - 파라미터 설명 정확성
               - 반환값 설명

            3. **docs/ 폴더**
               - API 문서가 코드와 동기화되어 있는지
               - 예제 코드가 컴파일되는지

            ## 작업 방식
            
            - 변경이 필요한 경우만 수정
            - 최소한의 변경으로 동기화
            - 변경사항이 있으면 PR 생성
`}
/>

---

## 5. 보안 검사 워크플로우

### OWASP 기반 보안 리뷰

<Source
  language="yaml"
  code={`
name: Security Review

on:
  pull_request:
    paths:
      - '**/*.c'
      - '**/*.h'

jobs:
  security-scan:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      security-events: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Security Analysis
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 변경사항에 대한 보안 분석을 수행해주세요.

            ## C 코드 보안 체크리스트
            
            ### 메모리 안전성
            - [ ] 버퍼 오버플로우 가능성
            - [ ] Use-after-free
            - [ ] 메모리 누수
            - [ ] 초기화되지 않은 변수 사용

            ### 입력 검증
            - [ ] 사용자 입력 검증
            - [ ] 배열 경계 검사
            - [ ] NULL 포인터 체크
            - [ ] 정수 오버플로우

            ### 안전하지 않은 함수
            - [ ] gets() 사용 (gets_s 또는 fgets 권장)
            - [ ] strcpy() 사용 (strncpy 권장)
            - [ ] sprintf() 사용 (snprintf 권장)
            - [ ] scanf() without width limit

            ### 기타
            - [ ] 하드코딩된 자격 증명
            - [ ] 민감 정보 로깅
            - [ ] 위험한 시스템 콜

            ## 출력 형식
            
            발견된 각 이슈에 대해:
            1. 심각도 (Critical/High/Medium/Low)
            2. 위치 (파일:라인)
            3. 설명
            4. 권장 수정 방법
            5. CWE 번호 (해당되는 경우)
`}
/>

---

## 6. 스케줄링 워크플로우

### 주간 코드 품질 리포트

<Source
  language="yaml"
  code={`
name: Weekly Quality Report

on:
  schedule:
    - cron: '0 9 * * 1'  # 매주 월요일 09:00 UTC

jobs:
  quality-report:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Generate Report
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            주간 코드 품질 리포트를 생성해주세요.

            ## 분석 항목
            
            1. **코드 복잡도**
               - 복잡한 함수 목록 (순환 복잡도 기준)
               - 리팩토링 권장 대상

            2. **코드 중복**
               - 중복 코드 패턴 발견
               - 공통화 제안

            3. **TODO/FIXME 현황**
               - 미해결 TODO 목록
               - 오래된 FIXME 경고

            4. **테스트 현황**
               - 테스트되지 않은 함수
               - 테스트 추가 권장 목록

            5. **문서화 현황**
               - 문서화되지 않은 public 함수
               - 오래된 문서 경고

            ## 출력
            
            분석 결과를 GitHub Issue로 생성해주세요.
            우선순위가 높은 개선사항은 별도 이슈로 분리해주세요.
`}
/>

---

## 워크플로우 조합 예시

### 완전 자동화 개발 파이프라인

<Mermaid chart={`
flowchart TB
    A["이슈 생성"] --> B["자동 분류"]
    B --> C["Claude 할당"]
    C --> D["자동 구현"]
    D --> E["PR 생성"]
    E --> F["자동 코드 리뷰"]
    F --> G{"리뷰 통과?"}
    G -->|Yes| H["자동 머지"]
    G -->|No| I["피드백 반영"]
    I --> F
    H --> J["릴리즈 노트 생성"]
    J --> K["팀 알림"]
`} />

---

## 핵심 정리

<div style={{
  backgroundColor: '#ede9fe',
  padding: '1rem',
  borderRadius: '8px',
  marginTop: '1.5rem'
}}>

1. **PR 리뷰** - 코드 품질, 보안, 성능 종합 분석
2. **이슈 관리** - 자동 분류, 라벨링, 구현까지
3. **릴리즈** - 릴리즈 노트 생성, 버전 범프 자동화
4. **문서 동기화** - 코드 변경 시 문서 자동 업데이트
5. **보안 검사** - OWASP 기반 취약점 분석
6. **스케줄링** - 주기적인 코드 품질 리포트

</div>

<ChapterNav
  prevLink="?path=/docs/chapters-08-github-actions-8-1-claude-code-action-소개--docs"
  prevTitle="8.1 Claude Code Action 소개"
/>
